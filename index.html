<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>複数検索エンジン同時検索</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .main-content {
            flex: 1 1 600px;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .history-panel {
            flex: 1 1 300px;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        #searchBox {
            width: 100%;
            height: 100px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .button-group, .checkbox-group, .option-group, .link-group {
            margin-bottom: 20px;
        }
        button, .link-button {
            padding: 10px 15px;
            margin-right: 10px;
            margin-bottom: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover, .link-button:hover {
            background-color: #45a049;
        }
        .link-button {
            display: inline-block;
            text-decoration: none;
        }
        label {
            margin-right: 15px;
        }
        #historyList {
            list-style-type: none;
            padding: 0;
        }
        #historyList li {
            cursor: pointer;
            padding: 5px;
            transition: background-color 0.3s;
        }
        #historyList li:hover {
            background-color: #f0f0f0;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
        #popupMessage {
            background-color: #ffeeba;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <h1>複数検索エンジン同時検索</h1>
            <textarea id="searchBox" placeholder="検索語句を入力してください"></textarea>
            <div class="button-group">
                <button id="searchAll">まとめて検索</button>
                <button id="copySearch">検索語句のコピー</button>
                <button id="clearSearch">検索語句のクリア</button>
            </div>
            <div class="checkbox-group">
                <h2>検索エンジン選択</h2>
                <label><input type="checkbox" name="searchEngine" value="google" checked> Google</label>
                <label><input type="checkbox" name="searchEngine" value="perplexity" checked> Perplexity</label>
                <label><input type="checkbox" name="searchEngine" value="genspark" checked> GenSpark</label>
                <label><input type="checkbox" name="searchEngine" value="yahoo" checked> Yahoo</label>
                <label><input type="checkbox" name="searchEngine" value="amazon" checked> Amazon</label>
                <label><input type="checkbox" name="searchEngine" value="rakuten" checked> 楽天市場</label>
                <label><input type="checkbox" name="searchEngine" value="yahooShopping" checked> Yahoo!ショッピング</label>
            </div>
            <div class="button-group">
                <button id="searchGoogle">Google検索</button>
                <button id="searchPerplexity">Perplexity検索</button>
                <button id="searchGenSpark">GenSpark検索</button>
                <button id="searchYahoo">Yahoo検索</button>
                <button id="searchAmazon">Amazon検索</button>
                <button id="searchRakuten">楽天市場検索</button>
                <button id="searchYahooShopping">Yahoo!ショッピング検索</button>
            </div>
            <div class="option-group">
                <h2>オプション</h2>
                <label><input type="checkbox" id="enterSearch" checked> エンターキーでの検索を有効にする</label>
                <label><input type="checkbox" id="recordHistory" checked> 検索履歴を記録する</label>
            </div>
            <div class="link-group">
                <h2>リンク</h2>
                <a href="https://gemini.google.com/" class="link-button" target="_blank">Gemini</a>
                <a href="https://aistudio.google.com/" class="link-button" target="_blank">AI Studio</a>
                <a href="https://claude.ai/" class="link-button" target="_blank">Claude</a>
                <a href="https://www.mapify.ai/" class="link-button" target="_blank">Mapify</a>
            </div>
            <div id="errorMessage" class="error"></div>
        </div>
        <div class="history-panel">
            <h2>検索履歴</h2>
            <ul id="historyList"></ul>
            <button id="clearHistory">履歴をクリア</button>
        </div>
    </div>
    <div id="popupMessage">
        注意: 複数のポップアップが開かれる可能性があります。ブラウザの設定でポップアップを許可してください。
    </div>

    <script>
        // 検索エンジンのURL
        const searchEngines = {
            google: 'https://google.co.jp/search?q=%s',
            perplexity: 'https://www.perplexity.ai/search/new?q=%s',
            genspark: 'https://www.genspark.ai/search?query=%s',
            yahoo: 'https://search.yahoo.co.jp/search?p=%s',
            amazon: 'https://www.amazon.co.jp/s?k=%s',
            rakuten: 'https://search.rakuten.co.jp/search/mall/%s/',
            yahooShopping: 'https://shopping.yahoo.co.jp/search?p=%s'
        };

        // DOM要素
        const searchBox = document.getElementById('searchBox');
        const searchAllBtn = document.getElementById('searchAll');
        const copySearchBtn = document.getElementById('copySearch');
        const clearSearchBtn = document.getElementById('clearSearch');
        const enterSearchCheckbox = document.getElementById('enterSearch');
        const recordHistoryCheckbox = document.getElementById('recordHistory');
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistory');
        const errorMessage = document.getElementById('errorMessage');

        // 設定の保存
        function saveSettings() {
            const settings = {
                enterSearch: enterSearchCheckbox.checked,
                recordHistory: recordHistoryCheckbox.checked,
                engines: {}
            };
            document.querySelectorAll('input[name="searchEngine"]').forEach(checkbox => {
                settings.engines[checkbox.value] = checkbox.checked;
            });
            localStorage.setItem('searchSettings', JSON.stringify(settings));
        }

        // 設定の復元
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('searchSettings'));
            if (settings) {
                enterSearchCheckbox.checked = settings.enterSearch;
                recordHistoryCheckbox.checked = settings.recordHistory;
                document.querySelectorAll('input[name="searchEngine"]').forEach(checkbox => {
                    checkbox.checked = settings.engines[checkbox.value];
                });
            }
        }

        // 検索履歴の保存
        function saveHistory(query) {
            if (recordHistoryCheckbox.checked) {
                let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
                if (!history.includes(query)) {
                    history.unshift(query);
                    history = history.slice(0, 10); // 最新10件のみ保持
                    localStorage.setItem('searchHistory', JSON.stringify(history));
                    updateHistoryList();
                }
            }
        }

        // 検索履歴の表示
        function updateHistoryList() {
            const history = JSON.parse(localStorage.getItem('searchHistory')) || [];
            historyList.innerHTML = '';
            history.forEach(query => {
                const li = document.createElement('li');
                li.textContent = query;
                li.addEventListener('click', () => {
                    searchBox.value = query;
                });
                historyList.appendChild(li);
            });
        }

        // 検索実行
        function performSearch(engine) {
            const query = searchBox.value.trim();
            if (query === '') {
                errorMessage.textContent = '検索語句を入力してください。';
                return;
            }
            errorMessage.textContent = '';

            let url;
            if (engine === 'amazon' || engine === 'rakuten') {
                // AmazonとRakutenの検索では空白を+に置換
                url = searchEngines[engine].replace('%s', encodeURIComponent(query.replace(/\s+/g, '+')));
            } else {
                url = searchEngines[engine].replace('%s', encodeURIComponent(query));
            }

            window.open(url, '_blank');
        }

        // まとめて検索
        function performAllSearch() {
            const query = searchBox.value.trim();
            if (query === '') {
                errorMessage.textContent = '検索語句を入力してください。';
                return;
            }
            errorMessage.textContent = '';

            document.querySelectorAll('input[name="searchEngine"]:checked').forEach(checkbox => {
                performSearch(checkbox.value);
            });

            // まとめて検索時に1回だけ履歴を保存
            saveHistory(query);
        }

        // まとめて検索ボタンのイベントリスナー
        searchAllBtn.addEventListener('click', performAllSearch);

        // 個別検索ボタンのイベントリスナー
        Object.keys(searchEngines).forEach(engine => {
            document.getElementById(`search${engine.charAt(0).toUpperCase() + engine.slice(1)}`).addEventListener('click', () => {
                performSearch(engine);
                saveHistory(searchBox.value.trim()); // 個別検索時にも履歴を保存
            });
        });

        // 検索語句のコピー
        copySearchBtn.addEventListener('click', () => {
            searchBox.select();
            document.execCommand('copy');
        });

        // 検索語句のクリア
        clearSearchBtn.addEventListener('click', () => {
            searchBox.value = '';
        });

        // エンターキーでの検索
        searchBox.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                performAllSearch(); // エンターキーで"まとめて検索"を実行
            }
        });

        // 検索履歴のクリア
        clearHistoryBtn.addEventListener('click', () => {
            localStorage.removeItem('searchHistory');
            updateHistoryList();
        });

        // 設定の変更時に保存
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', saveSettings);
        });

        // 初期化
        function initialize() {
            loadSettings();
            updateHistoryList();
        }

        // ページ読み込み時に初期化を実行
        window.addEventListener('load', initialize);
    </script>
</body>
</html>
